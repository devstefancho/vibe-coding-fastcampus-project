## ScrollSaver - 페이지 메모 & 스크롤 위치 북마크

## 목적

웹 브라우징 중 중요한 페이지를 북마크하고, 해당 페이지의 메모와 스크롤 위치를 저장하는 크롬 확장프로그램을 제작합니다. 사용자가 나중에 페이지를 다시 방문할 때 저장된 스크롤 위치로 자동으로 이동하고, 작성한 메모를 확인할 수 있습니다.

**주요 사용 시나리오:**
- 긴 아티클을 읽다가 중단한 경우, 다음에 방문 시 읽던 위치로 자동 이동
- 웹페이지별로 간단한 메모를 남겨 나중에 참고
- 저장된 페이지 목록을 검색하여 빠르게 찾기

**주요 기능:**
- 웹페이지당 1개의 메모 (최대 100글자 제한)
- 페이지의 스크롤 위치 자동 저장
- 페이지 재방문 시 저장된 스크롤 위치로 자동 이동
- 페이지 정보 저장/삭제 기능
- 메모 검색 기능
- 현재 페이지 저장 여부를 아이콘으로 표시

---

## 기술 스택

- **Chrome Extension Manifest V3**: 최신 크롬 확장프로그램 표준
- **HTML/CSS/JavaScript**: 순수 웹 기술로 UI 구현
- **Chrome Storage API**: 로컬 데이터 저장

---

## 프로젝트 구조

```
scrollsaver/
├── manifest.json              # 확장프로그램 설정 파일
├── popup/                     # 팝업 UI
│   ├── popup.html
│   ├── popup.css
│   └── popup.js
├── scripts/                   # 백그라운드 스크립트
│   ├── content.js            # 페이지에 삽입되는 스크립트
│   └── background.js         # 백그라운드 서비스 워커
└── icons/                     # 확장프로그램 아이콘
    ├── icon-active-16.png
    ├── icon-active-48.png
    ├── icon-active-128.png
    ├── icon-inactive-16.png
    ├── icon-inactive-48.png
    └── icon-inactive-128.png
```

---

## 데이터 구조 설계

각 저장된 페이지는 다음 정보를 포함합니다:

**페이지 데이터 필드:**
- `url`: 페이지 URL (키로 사용)
- `title`: 페이지 제목
- `memo`: 사용자가 작성한 메모 (최대 100자)
- `scrollY`: 스크롤 Y 위치 (픽셀 단위)
- `createdAt`: 최초 저장 시간
- `updatedAt`: 마지막 수정 시간

---

## Prompt

### 1. 크롬 확장프로그램 프로젝트 초기 설정

```markdown
ScrollSaver라는 크롬 확장프로그램 프로젝트를 생성해줘.

**프로젝트 요구사항:**
- Manifest V3 사용
- 이름: "ScrollSaver"
- 설명: "웹페이지의 메모와 스크롤 위치를 저장하고 관리하는 확장프로그램"
- 필요한 권한: storage, tabs, scripting, activeTab
- 모든 웹페이지에 접근 가능하도록 설정

**파일 구조:**
위의 "프로젝트 구조" 섹션과 동일하게 폴더와 파일 생성

manifest.json 파일을 완성하고, 나머지 파일들은 빈 파일로 생성해줘.
```

---

### 2. 확장프로그램 아이콘 생성

```markdown
ScrollSaver 확장프로그램의 아이콘을 생성해줘.

**요구사항:**
- 활성 상태 아이콘: 파란색 북마크 모양 (페이지가 저장된 경우)
- 비활성 상태 아이콘: 회색 북마크 모양 (페이지가 저장되지 않은 경우)
- 각각 16x16, 48x48, 128x128 크기로 생성 (총 6개 파일)
- 심플하고 깔끔한 디자인

SVG를 PNG로 변환하거나, Canvas를 사용해서 직접 생성하는 방법을 선택해서 만들어줘.
```

---

### 3. Popup UI 구현

```markdown
팝업 UI를 구현해줘 (popup.html, popup.css, popup.js).

⚠️ **중요:** viewport meta tag를 사용하지 마세요! (자세한 내용은 하단 "개발 중 주의사항 #1" 참조)

**UI 구성:**

1. **헤더:**
   - 제목: "ScrollSaver"
   - 현재 페이지 저장 여부 표시

2. **현재 페이지 섹션:**
   - 페이지 제목 표시
   - 메모 입력란 (textarea, 최대 100자, 글자 수 표시)
   - 저장 버튼 / 삭제 버튼

3. **저장된 페이지 목록:**
   - 검색창 (제목과 메모에서 검색)
   - 페이지 목록
     - 각 항목: 제목, 메모 미리보기, 저장 날짜
     - 클릭 시 해당 페이지로 이동
     - 삭제 버튼

4. **푸터:**
   - 총 저장된 페이지 수

**디자인:**
- 깔끔하고 미니멀한 스타일
- 너비 350px, 최대 높이 600px
- 파란색 계열 포인트 컬러

**기능:**
- 현재 탭의 정보를 자동으로 가져오기
- 저장된 데이터가 있으면 메모 표시
- 메모 100자 제한 및 실시간 글자 수 표시
- 검색 기능 (실시간 필터링)
- 목록 항목 클릭 시 해당 페이지로 이동
```

---

### 4. Content Script 구현 - 스크롤 위치 관리

```markdown
content.js를 구현해줘.

**기능:**

1. **페이지 로드 시:**
   - 저장된 스크롤 위치가 있으면 해당 위치로 자동 스크롤
   - 이미지 로딩을 고려하여 정확한 위치로 이동
   - 여러 번 시도 (0ms, 100ms, 300ms, 500ms, 1000ms, 2000ms)

2. **스크롤 감지:**
   - 사용자가 스크롤할 때 현재 위치를 저장
   - 너무 자주 저장하지 않도록 디바운스 적용 (500ms)
   - 저장된 페이지인 경우에만 업데이트

3. **메시지 통신:**
   - 팝업에서 요청 시 현재 스크롤 위치 전달
   - 저장 상태 업데이트 메시지 수신

4. **탭 간 동기화:**
   - Storage 변경 감지 리스너 추가
   - 다른 탭에서 스크롤 위치가 업데이트되면 자동 반영
```

---

### 5. Background Script 구현 - 아이콘 상태 관리

```markdown
background.js를 구현해줘.

**기능:**

1. **아이콘 상태 관리:**
   - 탭 전환(onActivated) 또는 페이지 로드(onUpdated) 시 현재 페이지 확인
   - 저장된 페이지면 파란색(active) 아이콘 표시
   - 저장되지 않은 페이지면 회색(inactive) 아이콘 표시

2. **메시지 수신:**
   - 팝업에서 저장/삭제 요청 시 아이콘 상태 업데이트

3. **초기 설정:**
   - 확장프로그램 설치 시 데이터 구조 초기화
   - 모든 탭의 아이콘 상태 업데이트

4. **에러 처리:**
   - 특수 페이지(chrome://, edge:// 등)에서 에러 처리 (자세한 내용은 "개발 중 주의사항 #3" 참조)
   - try-catch로 아이콘 설정 실패 처리
   - Console에 디버깅 로그 출력

5. **Storage 변경 감지:**
   - storage.onChanged 리스너로 데이터 변경 감지
   - 변경 시 모든 탭의 아이콘 자동 업데이트
```

---

### 6. 기능 개선 및 최적화

```markdown
ScrollSaver의 사용자 경험을 개선해줘.

**개선 사항:**

1. **메모 입력 UX:**
   - 100자 초과 시 입력 차단 및 시각적 피드백
   - 실시간 글자 수 카운터

2. **목록 정렬:**
   - 최근 수정한 페이지가 위로 오도록 정렬

3. **애니메이션:**
   - 저장/삭제 시 부드러운 피드백 효과
   - 목록 항목 호버 효과

4. **에러 처리:**
   - chrome:// 같은 특수 페이지에서는 기능 비활성화
   - 적절한 사용자 메시지 표시
```

---

### 7. 테스트 및 배포 준비

```markdown
ScrollSaver를 테스트하고 배포 준비를 해줘.

**테스트 항목:**
- Chrome에서 확장프로그램 로드 (chrome://extensions)
- 페이지 저장 및 아이콘 상태 변경 확인
- 스크롤 위치 복원 테스트
- 메모 검색 기능 테스트
- 여러 페이지 저장 및 관리 테스트

**배포 준비:**
- README.md 파일 작성 (설치 방법, 사용 방법 포함)
- 모든 기능이 정상 작동하는지 최종 점검
```

---

## 개발 중 주의사항

### 1. Viewport Meta Tag 사용 금지
크롬 확장프로그램의 팝업 페이지에는 **절대 viewport meta tag를 포함하지 마세요**.
```html
<!-- ❌ 사용하지 마세요 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
```
이 태그를 사용하면 팝업 너비가 매우 좁아집니다. CSS의 `body { width: 350px; }`로 크기를 제어하세요.

### 2. 확장프로그램 리로드 방법
코드 수정 후 반드시 확장프로그램을 리로드해야 변경사항이 반영됩니다:
1. `chrome://extensions` 접속
2. ScrollSaver 카드에서 **새로고침 버튼** 클릭
3. 또는 개발자 모드에서 **Reload** 버튼 클릭

### 3. 특수 페이지 제한사항
다음 페이지들에서는 확장프로그램이 작동하지 않습니다:
- `chrome://` (크롬 내부 페이지)
- `edge://` (엣지 내부 페이지)
- `about:` (브라우저 설정 페이지)
- `chrome-extension://` (다른 확장프로그램 페이지)

이런 페이지에서는 에러가 발생하므로 try-catch로 처리해야 합니다.

### 4. 디버깅 방법

**Popup 디버깅:**
- 팝업 열린 상태에서 **우클릭 → 검사**
- 또는 `chrome://extensions`에서 **검사 링크** 클릭

**Background Script 디버깅:**
- `chrome://extensions`에서 **service worker** 링크 클릭
- Background 전용 DevTools 창이 열림

**Content Script 디버깅:**
- 웹페이지에서 **F12** 또는 **우클릭 → 검사**
- Console 탭에서 content script 로그 확인

### 5. Chrome Storage API 특성
- **로컬 저장소**: 확장프로그램 삭제 시 데이터도 삭제됩니다
- **비동기 API**: 모든 storage 작업은 async/await 또는 callback 사용
- **저장 용량**: chrome.storage.local은 무제한 (Manifest V3)
- **데이터 구조**: JSON으로 직렬화 가능한 데이터만 저장 가능

### 6. 모바일 미디어 쿼리 사용 금지
확장프로그램 팝업에는 모바일 대응 미디어 쿼리가 필요 없습니다:
```css
/* ❌ 사용하지 마세요 */
@media (max-width: 400px) {
  body { width: 100%; }
}
```
팝업은 항상 고정 크기로 표시되므로 반응형 디자인이 불필요합니다.

---

## 학습 목표

이 강의를 완료하면 다음을 습득할 수 있습니다:

- Chrome Extension Manifest V3 기본 구조 이해
- Popup, Content Script, Background Script의 역할과 통신 방법
- Chrome Storage API를 활용한 데이터 관리
- 실전 크롬 확장프로그램 개발 경험
- 사용자 경험을 고려한 UI/UX 설계

---

## 자주 발생하는 문제와 해결법

### 문제 1: 팝업 너비가 너무 좁게 나옴
**증상:** 확장프로그램 팝업이 예상보다 훨씬 좁게 표시됨

**원인:** popup.html에 viewport meta tag가 포함되어 있거나 모바일 미디어 쿼리 사용

**해결방법:**
1. popup.html에서 viewport meta tag 라인 삭제 (상세 내용은 "개발 중 주의사항 #1" 참조)
2. popup.css에서 모바일 미디어 쿼리 삭제 (상세 내용은 "개발 중 주의사항 #6" 참조)
3. 확장프로그램 리로드 (방법은 "개발 중 주의사항 #2" 참조)

### 문제 2: 아이콘 상태가 업데이트되지 않음
**증상:** 페이지를 저장했는데 아이콘이 회색으로 남아있음

**원인:**
- 확장프로그램이 리로드되지 않음
- Background script의 이벤트 리스너 미작동

**해결방법:**
1. 확장프로그램 새로고침 ("개발 중 주의사항 #2" 참조)
2. 탭을 닫았다가 다시 열기
3. Background script의 `chrome.tabs.onUpdated` 리스너 확인
4. Console에서 에러 확인 ("개발 중 주의사항 #4" 참조)

### 문제 3: 스크롤 위치가 복원되지 않음
**증상:** 저장된 페이지를 다시 방문해도 스크롤 위치가 복원되지 않음

**원인:**
- Content script가 페이지에 주입되지 않음
- 이미지 로딩 완료 전에 스크롤 시도

**해결방법:**
1. manifest.json에서 `content_scripts` → `matches` 확인
2. `run_at: "document_idle"` 설정 확인
3. Content script에서 여러 시도 간격으로 스크롤 복원 (자세한 내용은 "Prompt 4" 참조)

### 문제 4: Storage에 데이터가 저장되지 않음
**증상:** 페이지를 저장했는데 다시 열면 데이터가 없음

**원인:**
- manifest.json에 `storage` 권한 누락
- 비동기 처리 오류

**해결방법:**
1. manifest.json의 `permissions` 배열에 `"storage"` 추가
2. `chrome.storage.local.set()` 호출 시 `await` 사용 ("개발 중 주의사항 #5" 참조)
3. DevTools Console에서 에러 메시지 확인 ("개발 중 주의사항 #4" 참조)

### 문제 5: 특정 페이지에서 확장프로그램이 작동하지 않음
**증상:** chrome://, edge:// 페이지에서 확장프로그램이 작동 안 함

**원인 및 해결방법:**
이는 정상 동작입니다. 브라우저 보안 정책상 특수 페이지에서는 확장프로그램 실행이 불가능합니다.
("개발 중 주의사항 #3" 참조)

**권장 처리 방법:**
Popup에서 특수 페이지 감지 후 사용자에게 안내 메시지 표시:
```javascript
if (url.startsWith('chrome://') || url.startsWith('edge://') || url.startsWith('about:')) {
  // 사용자에게 "이 페이지에서는 사용할 수 없습니다" 메시지 표시
}
```

### 문제 6: 검색 기능이 작동하지 않음
**증상:** 검색창에 텍스트를 입력해도 목록이 필터링되지 않음

**원인:** 검색 input의 이벤트 리스너 미등록

**해결방법:**
1. popup.js에서 `searchInput` 요소의 `input` 이벤트 리스너 확인
2. `renderPageList()` 함수가 검색어를 받아 필터링하는지 확인
3. 대소문자 구분 없는 검색을 위해 `.toLowerCase()` 사용

### 문제 7: 확장프로그램 설치가 안 됨
**증상:** `chrome://extensions`에서 로드 시 에러 발생

**주요 원인별 해결방법:**

**"Manifest file is missing or unreadable"**
- manifest.json 파일이 프로젝트 루트에 있는지 확인
- JSON 문법 오류 확인 (쉼표, 괄호 등)

**"Required value 'manifest_version' is missing"**
- manifest.json에 `"manifest_version": 3` 추가

**"Permissions ... unknown or not allowed"**
- 잘못된 권한 이름 확인
- 허용된 권한: storage, tabs, scripting, activeTab

**"Could not load icon"**
- icons 폴더와 아이콘 파일들이 존재하는지 확인
- manifest.json의 아이콘 경로가 정확한지 확인

---

## 추가 개선 아이디어

프로젝트를 완성한 후 다음 기능들을 추가로 구현해보세요:

1. **다크 모드 지원**
2. **카테고리/태그 기능** - 페이지를 분류
3. **내보내기/가져오기** - JSON 형태로 백업
4. **단축키 지원** - 키보드로 빠른 저장
5. **통계 대시보드** - 저장한 페이지 통계
6. **동기화** - 여러 기기 간 데이터 동기화
